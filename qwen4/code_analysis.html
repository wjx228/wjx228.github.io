<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç æ™ºèƒ½åˆ†æå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            padding: 25px;
            background: #fafbfc;
        }

        .panel h2 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.5em;
        }

        .code-editor {
            width: 100%;
            min-height: 300px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            resize: vertical;
            background: #f8fafc;
            color: #2d3748;
            transition: border-color 0.3s;
        }

        .code-editor:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #fc8181;
            color: white;
        }

        .btn-danger:hover {
            background: #f56565;
            transform: translateY(-1px);
        }

        .analysis-result {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }

        .analysis-result h3 {
            color: #2d3748;
            margin: 15px 0 10px 0;
        }

        .analysis-result ul, .analysis-result ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .analysis-result li {
            margin: 5px 0;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #e2e8f0;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .comparison-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .execution-log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.4;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-info { color: #63b3ed; }
        .log-success { color: #68d391; }
        .log-warning { color: #f6e05e; }
        .log-error { color: #fc8181; }
        .log-ai { color: #b794f4; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ä»£ç æ™ºèƒ½åˆ†æå™¨</h1>
            <p>ä¸Šä¼ ä»£ç è‡ªåŠ¨è§£æç”¨é€” | è¿è¡Œæ—¶æ™ºèƒ½åˆ†æ | ä»£ç ä¼˜åŠ£æ¯”è¾ƒ</p>
            <div class="status-indicator" id="serviceStatus">
                æœåŠ¡çŠ¶æ€: æ£€æŸ¥ä¸­...
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“ ä»£ç ç¼–è¾‘å™¨</h2>
                <textarea id="codeEditor" class="code-editor" placeholder="ç²˜è´´æ‚¨çš„ä»£ç åˆ°è¿™é‡Œ...">
# ç¤ºä¾‹ä»£ç 
def fibonacci(n):
    """è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—"""
    if n <= 0:
        return 0
    elif n == 1:
        return 1
    else:
        a, b = 0, 1
        for i in range(2, n + 1):
            a, b = b, a + b
        return b

def factorial(n):
    """è®¡ç®—é˜¶ä¹˜"""
    result = 1
    for i in range(1, n + 1):
        result *= i
    return result

# æµ‹è¯•ä»£ç 
if __name__ == "__main__":
    print("æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬10é¡¹:", fibonacci(10))
    print("10çš„é˜¶ä¹˜:", factorial(10))
    print("è®¡ç®—å®Œæˆ!")
                </textarea>
                <div class="btn-group">
                    <button class="btn-primary" onclick="analyzeCode()">
                        <span>ğŸ“Š</span> åˆ†æä»£ç 
                    </button>
                    <button class="btn-primary" onclick="executeCode()">
                        <span>â–¶ï¸</span> è¿è¡Œå¹¶åˆ†æ
                    </button>
                    <button class="btn-secondary" onclick="loadExample()">
                        <span>ğŸ“‹</span> åŠ è½½ç¤ºä¾‹
                    </button>
                    <button class="btn-secondary" onclick="clearEditor()">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©º
                    </button>
                </div>

                <div class="loading" id="loading1">
                    <div class="spinner"></div>
                    <p>AIæ­£åœ¨åˆ†æä»£ç ...</p>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ“ˆ åˆ†æç»“æœ</h2>
                <div id="analysisResult" class="analysis-result">
                    åˆ†æç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
                <div id="executionLog" class="execution-log" style="display: none;">
                    <!-- æ‰§è¡Œæ—¥å¿—å°†åŠ¨æ€æ’å…¥ -->
                </div>
            </div>

            <div class="comparison-section">
                <div class="panel">
                    <h2>ğŸ”„ ä»£ç æ¯”è¾ƒ (A)</h2>
                    <textarea id="codeA" class="code-editor" placeholder="ç¬¬ä¸€æ®µä»£ç ..." style="min-height: 200px;">
def sum_list_for_loop(lst):
    total = 0
    for num in lst:
        total += num
    return total
                    </textarea>
                </div>
                <div class="panel">
                    <h2>ğŸ”„ ä»£ç æ¯”è¾ƒ (B)</h2>
                    <textarea id="codeB" class="code-editor" placeholder="ç¬¬äºŒæ®µä»£ç ..." style="min-height: 200px;">
def sum_list_builtin(lst):
    return sum(lst)
                    </textarea>
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn-primary" onclick="compareCode()">
                            <span>âš–ï¸</span> æ¯”è¾ƒä»£ç 
                        </button>
                    </div>
                    <div class="loading" id="loading2">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨æ¯”è¾ƒä»£ç ...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://' + window.location.hostname + ':5000/api';
        let currentExecutionId = null;
        let pollInterval = null;

        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        async function checkServiceStatus() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                const statusEl = document.getElementById('serviceStatus');
                
                if (data.status === 'ok') {
                    statusEl.textContent = 'âœ… æœåŠ¡çŠ¶æ€: æ­£å¸¸';
                    statusEl.className = 'status-indicator status-active';
                } else {
                    statusEl.textContent = 'âŒ æœåŠ¡çŠ¶æ€: å¼‚å¸¸';
                    statusEl.className = 'status-indicator status-error';
                }
            } catch (error) {
                document.getElementById('serviceStatus').textContent = 'âŒ æœåŠ¡çŠ¶æ€: è¿æ¥å¤±è´¥';
                document.getElementById('serviceStatus').className = 'status-indicator status-error';
            }
        }

        // åˆ†æä»£ç 
        async function analyzeCode() {
            const code = document.getElementById('codeEditor').value;
            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ');
                return;
            }

            document.getElementById('loading1').classList.add('active');
            document.getElementById('executionLog').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/code/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();
                
                if (response.ok) {
                    displayAnalysisResult(data.analysis);
                } else {
                    throw new Error(data.error || 'åˆ†æå¤±è´¥');
                }
            } catch (error) {
                displayAnalysisResult(`âŒ åˆ†æå¤±è´¥: ${error.message}`);
            } finally {
                document.getElementById('loading1').classList.remove('active');
            }
        }

        // æ‰§è¡Œä»£ç å¹¶ç›‘æ§
        async function executeCode() {
            const code = document.getElementById('codeEditor').value;
            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ');
                return;
            }

            document.getElementById('loading1').classList.add('active');
            document.getElementById('executionLog').style.display = 'block';
            clearExecutionLog();
            addToLog('ğŸš€ å¼€å§‹æ‰§è¡Œä»£ç ...', 'info');

            try {
                const response = await fetch(`${API_BASE}/code/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: code,
                        user_id: 'web_user_' + Date.now()
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    addToLog('âœ… ä»£ç å·²æäº¤æ‰§è¡Œ', 'success');
                    addToLog(`ğŸ“‹ æ‰§è¡ŒID: ${data.execution_id}`, 'info');
                    
                    // æ˜¾ç¤ºé™æ€åˆ†æ
                    displayAnalysisResult(data.static_analysis);
                    
                    // å¼€å§‹è½®è¯¢æ‰§è¡Œç»“æœ
                    currentExecutionId = data.execution_id;
                    startPollingExecution();
                } else {
                    throw new Error(data.error || 'æ‰§è¡Œå¤±è´¥');
                }
            } catch (error) {
                addToLog(`âŒ æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
            } finally {
                document.getElementById('loading1').classList.remove('active');
            }
        }

        // è½®è¯¢æ‰§è¡Œç»“æœ
        function startPollingExecution() {
            if (pollInterval) clearInterval(pollInterval);
            
            pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE}/code/result/${currentExecutionId}`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        const result = data.result;
                        
                        if (result.success !== undefined) {
                            // æ‰§è¡Œå®Œæˆ
                            clearInterval(pollInterval);
                            
                            addToLog('\nğŸ“Š æ‰§è¡Œå®Œæˆ!', 'success');
                            
                            if (result.stdout) {
                                addToLog('\nğŸ“„ è¾“å‡ºç»“æœ:', 'info');
                                addToLog(result.stdout, 'info');
                            }
                            
                            if (result.stderr) {
                                addToLog('\nâš ï¸ é”™è¯¯ä¿¡æ¯:', 'warning');
                                addToLog(result.stderr, 'error');
                            }
                            
                            if (result.timeout) {
                                addToLog('\nâ° æ‰§è¡Œè¶…æ—¶', 'error');
                            }
                        }
                    }
                } catch (error) {
                    console.error('è½®è¯¢å¤±è´¥:', error);
                }
            }, 1000);
        }

        // æ¯”è¾ƒä»£ç 
        async function compareCode() {
            const codeA = document.getElementById('codeA').value;
            const codeB = document.getElementById('codeB').value;
            
            if (!codeA.trim() || !codeB.trim()) {
                alert('è¯·è¾“å…¥ä¸¤æ®µä»£ç è¿›è¡Œæ¯”è¾ƒ');
                return;
            }

            document.getElementById('loading2').classList.add('active');

            try {
                const response = await fetch(`${API_BASE}/code/compare`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code_a: codeA,
                        code_b: codeB
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    displayAnalysisResult(data.comparison);
                } else {
                    throw new Error(data.error || 'æ¯”è¾ƒå¤±è´¥');
                }
            } catch (error) {
                displayAnalysisResult(`âŒ æ¯”è¾ƒå¤±è´¥: ${error.message}`);
            } finally {
                document.getElementById('loading2').classList.remove('active');
            }
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysisResult(content) {
            const resultEl = document.getElementById('analysisResult');
            resultEl.innerHTML = formatMarkdown(content);
        }

        // æ¸…ç©ºç¼–è¾‘å™¨
        function clearEditor() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºä»£ç ç¼–è¾‘å™¨å—ï¼Ÿ')) {
                document.getElementById('codeEditor').value = '';
            }
        }

        // åŠ è½½ç¤ºä¾‹ä»£ç 
        function loadExample() {
            const exampleCode = `# å¿«é€Ÿæ’åºç®—æ³•ç¤ºä¾‹
def quick_sort(arr):
    """å¿«é€Ÿæ’åºå®ç°"""
    if len(arr) <= 1:
        return arr
    
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    
    return quick_sort(left) + middle + quick_sort(right)

# æ€§èƒ½æµ‹è¯•
def performance_test():
    import time
    import random
    
    # ç”Ÿæˆæµ‹è¯•æ•°æ®
    test_data = [random.randint(0, 10000) for _ in range(1000)]
    
    # æµ‹è¯•å¿«é€Ÿæ’åº
    start_time = time.time()
    sorted_data = quick_sort(test_data.copy())
    end_time = time.time()
    
    print(f"æ’åºè€—æ—¶: {end_time - start_time:.4f}ç§’")
    print(f"æ’åºéªŒè¯: {sorted_data[:10]}... ç­‰1000ä¸ªå…ƒç´ ")
    return sorted_data

if __name__ == "__main__":
    print("=== å¿«é€Ÿæ’åºæ€§èƒ½æµ‹è¯• ===")
    result = performance_test()
    print("æµ‹è¯•å®Œæˆ!")`;
            
            document.getElementById('codeEditor').value = exampleCode;
        }

        // æ‰§è¡Œæ—¥å¿—ç›¸å…³å‡½æ•°
        function clearExecutionLog() {
            const logEl = document.getElementById('executionLog');
            logEl.innerHTML = '';
        }

        function addToLog(message, type = 'info') {
            const logEl = document.getElementById('executionLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEl.appendChild(logEntry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        // ç®€å•çš„Markdownæ ¼å¼åŒ–
        function formatMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\s*(\d+)\./g, '\n<br><strong>$1.</strong>')
                .replace(/\n\s*[-*]\s/g, '\n<br>â€¢ ')
                .replace(/\n/g, '<br>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkServiceStatus();
            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡çŠ¶æ€
            setInterval(checkServiceStatus, 30000);
        });
    </script>
</body>
</html>
